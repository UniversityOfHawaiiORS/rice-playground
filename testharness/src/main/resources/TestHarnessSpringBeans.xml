<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!-- The workflow engine Spring configuration is bifurcated into data source and bean configuration
     to allow independent replacement of the data source configuration (for example for unit tests) -->
<beans>
  <!-- This PropertyPlaceholderConfigurer subclass automagically takes properties from the workflow Config system -->
  <bean class="org.kuali.rice.config.spring.ConfigPropertyPlaceholderConfigurer" />

  <bean id="ojbConfigurer" class="org.kuali.rice.ojb.JtaOjbConfigurer">
    <property name="transactionManager" ref="jtaTransactionManager"/>
  </bean>

  <bean id="atomikosTransactionManager" class="com.atomikos.icatch.jta.UserTransactionManager" init-method="init" destroy-method="close">
	<property name="forceShutdown" value="true"/>
	<property name="transactionTimeout" value="${transaction.timeout}"/>
  </bean>
  
  <bean id="atomikosUserTransaction" class="com.atomikos.icatch.jta.UserTransactionImp">
    <property name="transactionTimeout" value="${transaction.timeout}"/>
  </bean>

  <bean id="userTransaction" class="org.kuali.rice.jta.UserTransactionFactoryBean">
  	<property name="defaultUserTransaction"><ref local="atomikosUserTransaction"/></property>
  </bean>
  <bean id="jtaTransactionManager" class="org.kuali.rice.jta.TransactionManagerFactoryBean">
  	<property name="defaultTransactionManager"><ref local="atomikosTransactionManager"/></property>
  </bean>

  <bean id="transactionManager" class="org.springframework.transaction.jta.JtaTransactionManager">
    <property name="userTransaction"><ref local="userTransaction"/></property>
    <property name="transactionManager"><ref local="jtaTransactionManager"/></property>
  </bean>

	<bean id="transactionTemplate" class="org.springframework.transaction.support.TransactionTemplate">
		<property name="transactionManager">
			<ref bean="transactionManager" />
		</property>
	</bean>
  
  <bean id="dataSource" class="com.atomikos.jdbc.nonxa.NonXADataSourceBean">
  	<property name="driverClassName" value="${datasource.driver.name}"/>
  	<property name="url" value="${datasource.url}"/>
  	<property name="poolSize" value="${datasource.pool.maxSize}"/>
  	<property name="connectionTimeout" value="${datasource.pool.maxWait}"/>
  	<property name="validatingQuery" value="${datasource.pool.validationQuery}"/>
  	<property name="testOnBorrow" value="true"/>
  	<property name="user" value="${datasource.username}"/>
  	<property name="password" value="${datasource.password}"/>
  </bean>

</beans>