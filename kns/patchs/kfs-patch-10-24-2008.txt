Index: C:/java/projects/kfs/work/src/org/kuali/kfs/pdp/document/datadictionary/AchBankMaintenanceDocument.xml
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/pdp/document/datadictionary/AchBankMaintenanceDocument.xml	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/pdp/document/datadictionary/AchBankMaintenanceDocument.xml	(working copy)
@@ -72,15 +72,14 @@
         <bean parent="MaintainableFieldDefinition">
           <property name="name" value="bankRoutingNumber" />
           <property name="required" value="true" />
-          <property name="displayMask" >
-            <bean parent="Mask">
-              <property name="maskFormatter" >
-                <bean parent="MaskFormatterLiteral"
-                      p:literal="*********" />
-              </property>
-            </bean>
-          </property>
-          <property name="displayEditMode" value="entry" />
+		  <property name="attributeSecurity">
+		    	<bean class="org.kuali.rice.kns.datadictionary.AttributeSecurity">
+		    		<property name="mask" value="true"></property>
+		    		<property name="maskFormatter">
+		    			<bean parent="MaskFormatterLiteral" p:literal="xxxxxxxxxxxxxxxxxxxxxxxxxxxx" />
+		    		</property>
+		    	</bean>
+		  </property>
         </bean> 
         <bean parent="MaintainableFieldDefinition"
               p:name="bankOfficeCode"
Index: C:/java/projects/kfs/work/src/org/kuali/kfs/pdp/document/datadictionary/PayeeAchAccountMaintenanceDocument.xml
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/pdp/document/datadictionary/PayeeAchAccountMaintenanceDocument.xml	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/pdp/document/datadictionary/PayeeAchAccountMaintenanceDocument.xml	(working copy)
@@ -83,15 +83,14 @@
         <bean parent="MaintainableFieldDefinition">
           <property name="name" value="bankRoutingNumber" />
           <property name="required" value="true" />
-          <property name="displayMask" >
-            <bean parent="Mask">
-              <property name="maskFormatter" >
-                <bean parent="MaskFormatterLiteral"
-                      p:literal="*********" />
-              </property>
-            </bean>
-          </property>
-          <property name="displayEditMode" value="entry" />
+		  <property name="attributeSecurity">
+		    	<bean class="org.kuali.rice.kns.datadictionary.AttributeSecurity">
+		    		<property name="mask" value="true"></property>
+		    		<property name="maskFormatter">
+		    			<bean parent="MaskFormatterLiteral" p:literal="*********" />
+		    		</property>
+		    	</bean>
+		  </property>
           <property name="webUILeaveFieldFunction" value="loadAchBankInfo" />
         </bean>
         <bean parent="MaintainableFieldDefinition"
@@ -100,15 +99,14 @@
         <bean parent="MaintainableFieldDefinition">
           <property name="name" value="bankAccountNumber" />
           <property name="required" value="true" />
-          <property name="displayMask" >
-            <bean parent="Mask">
-              <property name="maskFormatter" >
-                <bean parent="MaskFormatterLiteral"
-                      p:literal="*****************" />
-              </property>
-            </bean>
-          </property>
-          <property name="displayEditMode" value="entry" />
+		  <property name="attributeSecurity">
+		    	<bean class="org.kuali.rice.kns.datadictionary.AttributeSecurity">
+		    		<property name="mask" value="true"></property>
+		    		<property name="maskFormatter">
+		    			<bean parent="MaskFormatterLiteral" p:literal="*****************" />
+		    		</property>
+		    	</bean>
+		  </property>
         </bean>
         <bean parent="MaintainableFieldDefinition"
               p:name="bankAccountTypeCode"
Index: C:/java/projects/kfs/work/src/org/kuali/kfs/module/ar/batch/CustomerInvoiceDocumentBatchStep.java
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/module/ar/batch/CustomerInvoiceDocumentBatchStep.java	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/module/ar/batch/CustomerInvoiceDocumentBatchStep.java	(working copy)
@@ -24,11 +24,9 @@
 import java.util.Map;
 
 import org.apache.commons.lang.time.DateUtils;
-import org.apache.commons.collections.list.AbstractLinkedList;
 import org.kuali.kfs.module.ar.businessobject.CustomerInvoiceDetail;
 import org.kuali.kfs.module.ar.document.CustomerInvoiceDocument;
 import org.kuali.kfs.module.ar.document.service.CustomerInvoiceDocumentService;
-import org.kuali.kfs.module.purap.batch.ElectronicInvoiceStep;
 import org.kuali.kfs.sys.batch.AbstractStep;
 import org.kuali.kfs.sys.batch.Job;
 import org.kuali.kfs.sys.context.SpringContext;
@@ -42,10 +40,7 @@
 import org.kuali.rice.kns.service.PersistenceStructureService;
 import org.kuali.rice.kns.util.GlobalVariables;
 import org.kuali.rice.kns.util.KualiDecimal;
-import org.kuali.rice.kns.bo.user.UniversalUser;
 
-import com.sun.xml.internal.fastinfoset.util.StringArray;
-
 public class CustomerInvoiceDocumentBatchStep extends AbstractStep {
     
     CustomerInvoiceDocumentService customerInvoiceDocumentService; 
Index: C:/java/projects/kfs/work/src/org/kuali/kfs/vnd/businessobject/options/VendorOwnershipCodeValuesFinder.java
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/vnd/businessobject/options/VendorOwnershipCodeValuesFinder.java	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/vnd/businessobject/options/VendorOwnershipCodeValuesFinder.java	(working copy)
@@ -37,17 +37,32 @@
      * @see org.kuali.keyvalues.KeyValuesFinder#getKeyValues()
      */
     public List getKeyValues() {
+        return getKeyValues(true);
+    }
 
+    /***
+     * @see org.kuali.rice.kns.lookup.keyvalues.KeyValuesFinder#getInactiveKeyValues()
+     */
+    public List getKeyValues(boolean active){
         KeyValuesService boService = SpringContext.getBean(KeyValuesService.class);
-        Collection codes = boService.findAll(OwnershipType.class);
+        Collection codes;
+        if(active)
+            codes = boService.findAll(OwnershipType.class);
+        else
+            codes = boService.findAllInactive(OwnershipType.class);
         List labels = new ArrayList();
-        labels.add(new KeyLabelPair("", ""));
+        if(active)
+            labels.add(new KeyLabelPair("", ""));
         for (Iterator iter = codes.iterator(); iter.hasNext();) {
             OwnershipType ot = (OwnershipType) iter.next();
-            labels.add(new KeyLabelPair(ot.getVendorOwnershipCode(), ot.getVendorOwnershipDescription()));
+            if(active)
+                labels.add(new KeyLabelPair(ot.getVendorOwnershipCode(), ot.getVendorOwnershipDescription()));
+            else
+                labels.add(new KeyLabelPair(ot.getVendorOwnershipCode(), ot.getVendorOwnershipDescription()+(" (inactive)")));
         }
 
         return labels;
+
     }
 
 }
Index: C:/java/projects/kfs/work/src/org/kuali/kfs/vnd/document/datadictionary/VendorDetailMaintenanceDocument.xml
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/vnd/document/datadictionary/VendorDetailMaintenanceDocument.xml	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/vnd/document/datadictionary/VendorDetailMaintenanceDocument.xml	(working copy)
@@ -97,15 +97,14 @@
               p:required="true" />
         <bean parent="MaintainableFieldDefinition">
           <property name="name" value="vendorHeader.vendorTaxNumber" />
-          <property name="displayMask" >
-            <bean parent="Mask">
-              <property name="maskFormatter" >
-                <bean parent="MaskFormatterLiteral"
-                      p:literal="*********" />
-              </property>
-            </bean>
-          </property>
-          <property name="displayEditMode" value="taxEntry" />
+		  <property name="attributeSecurity">
+		    	<bean class="org.kuali.rice.kns.datadictionary.AttributeSecurity">
+		    		<property name="mask" value="true"></property>
+		    		<property name="maskFormatter">
+		    			<bean parent="MaskFormatterLiteral" p:literal="*********" />
+		    		</property>
+		    	</bean>
+		  </property>
         </bean>
         <bean parent="MaintainableFieldDefinition"
               p:name="vendorHeader.vendorTaxTypeCode" />
Index: C:/java/projects/kfs/work/src/org/kuali/kfs/vnd/document/authorization/VendorDocumentAuthorizer.java
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/vnd/document/authorization/VendorDocumentAuthorizer.java	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/vnd/document/authorization/VendorDocumentAuthorizer.java	(working copy)
@@ -59,7 +59,7 @@
      */
     @Override
     public MaintenanceDocumentAuthorizations getFieldAuthorizations(MaintenanceDocument document, UniversalUser user) {
-        MaintenanceDocumentAuthorizations auths = new MaintenanceDocumentAuthorizations();
+        MaintenanceDocumentAuthorizations auths = super.getFieldAuthorizations(document, user);
         VendorDetail vendor = (VendorDetail) document.getNewMaintainableObject().getBusinessObject();
         VendorDetail oldVendor = (VendorDetail) document.getOldMaintainableObject().getBusinessObject();
         VendorHeader vendorHeader = vendor.getVendorHeader();
@@ -224,4 +224,12 @@
             collDef.setIncludeAddLine(true);
         }
     }
+    
+    private void setTaxNumberFieldAuthorization(VendorDetail vendor, MaintenanceDocumentAuthorizations auths, UniversalUser user, String purchasingWorkgroup) {
+        //If the user is not in purchasing workgroup, we need to set the includeAddLine to false for vendorCommodities collection
+        //and set the commodity default indicator and active indicator to be read only.
+        if (!user.isMember(purchasingWorkgroup)) {
+            auths.addReadonlyAuthField("vendorHeader.vendorTaxNumber");
+        }
+    }
 }
Index: C:/java/projects/kfs/work/src/org/kuali/kfs/sys/businessobject/datadictionary/Bank.xml
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/sys/businessobject/datadictionary/Bank.xml	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/sys/businessobject/datadictionary/Bank.xml	(working copy)
@@ -118,6 +118,14 @@
       <bean parent="TextControlDefinition"
             p:size="15" />
     </property>
+    <property name="attributeSecurity">
+    	<bean class="org.kuali.rice.kns.datadictionary.AttributeSecurity">
+    		<property name="mask" value="true"></property>
+    		<property name="maskFormatter">
+    			<bean parent="MaskFormatterLiteral" p:literal="xxxxxxxxxxxxxxxxxxxxxxxxxxxx" />
+    		</property>
+    	</bean>
+    </property>
     <property name="displayMask" >
       <bean parent="Mask">
         <property name="maskFormatter" >
Index: C:/java/projects/kfs/work/src/org/kuali/kfs/sys/businessobject/datadictionary/FinancialSystemUser.xml
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/sys/businessobject/datadictionary/FinancialSystemUser.xml	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/sys/businessobject/datadictionary/FinancialSystemUser.xml	(working copy)
@@ -546,14 +546,14 @@
         <bean parent="MaintainableFieldDefinition" p:name="embeddedUniversalUser.personPayrollIdentifier" />
         <bean parent="MaintainableFieldDefinition" p:name="embeddedUniversalUser.personTaxIdentifierTypeCode" />
         <bean parent="MaintainableFieldDefinition" p:name="embeddedUniversalUser.personTaxIdentifier">
-          <property name="displayMask" >
-            <bean parent="Mask">
-              <property name="maskFormatter" >
-                <bean parent="MaskFormatterLiteral" p:literal="***************" />
-              </property>
-            </bean>
-          </property>
-          <property name="displayEditMode" value="ssnEditEntry" />
+		  <property name="attributeSecurity">
+		    	<bean class="org.kuali.rice.kns.datadictionary.AttributeSecurity">
+		    		<property name="mask" value="true"></property>
+		    		<property name="maskFormatter">
+		    			<bean parent="MaskFormatterLiteral" p:literal="*********" />
+		    		</property>
+		    	</bean>
+		  </property>
         </bean>
         <bean parent="MaintainableFieldDefinition" p:name="embeddedUniversalUser.financialSystemsEncryptedPasswordText" />
         <bean parent="MaintainableFieldDefinition" p:name="embeddedUniversalUser.personCampusAddress" />
Index: C:/java/projects/kfs/work/src/org/kuali/kfs/sys/document/datadictionary/AccountingLineViewCurrentBaseAmountFieldDefinition.java
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/sys/document/datadictionary/AccountingLineViewCurrentBaseAmountFieldDefinition.java	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/sys/document/datadictionary/AccountingLineViewCurrentBaseAmountFieldDefinition.java	(working copy)
@@ -21,6 +21,7 @@
 import org.kuali.kfs.sys.document.service.AccountingLineRenderingService;
 import org.kuali.kfs.sys.document.web.AccountingLineViewCurrentBaseAmount;
 import org.kuali.kfs.sys.document.web.TableJoining;
+import org.kuali.rice.kns.datadictionary.AttributeSecurity;
 import org.kuali.rice.kns.datadictionary.BusinessObjectEntry;
 import org.kuali.rice.kns.datadictionary.DataDictionary;
 import org.kuali.rice.kns.datadictionary.MaintainableFieldDefinition;
@@ -112,15 +113,9 @@
             throw new AttributeValidationException("Both defaultValue and defaultValueFinderClass can not be specified on attribute " + getName() + " in rootBusinessObjectClass " + rootBusinessObjectClass.getName());
         }
 
-        if (StringUtils.isNotBlank(displayEditMode) && displayMask == null) {
-            throw new AttributeValidationException("property '" + getName() + "' has a display edit mode defined but not a valid display mask '" + "' (" + "" + ")");
+        if (getAttributeSecurity() != null) {
+            getAttributeSecurity().completeValidation(rootBusinessObjectClass, otherBusinessObjectClass);
         }
-
-        if (displayMask != null) {
-            if (getDisplayMask().getMaskFormatter() == null && getDisplayMask().getMaskFormatterClass() == null) {
-                throw new AttributeValidationException("No mask formatter or formatter class specified for secure attribute " + getName() + "' (" + "" + ")");
-            }
-        }
     }
 
     /**
Index: C:/java/projects/kfs/work/src/org/kuali/kfs/sys/document/service/impl/AccountingLineRenderingServiceImpl.java
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/sys/document/service/impl/AccountingLineRenderingServiceImpl.java	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/sys/document/service/impl/AccountingLineRenderingServiceImpl.java	(working copy)
@@ -283,8 +283,9 @@
         fieldDefinition.setTemplate(currentDefinition.getTemplate());
         fieldDefinition.setDefaultValueFinderClass(currentDefinition.getDefaultValueFinderClass());
         
-        fieldDefinition.setDisplayEditMode(currentDefinition.getDisplayEditMode());
-        fieldDefinition.setDisplayMask(currentDefinition.getDisplayMask());
+        //fieldDefinition.setDisplayEditMode(currentDefinition.getDisplayEditMode());
+        if(currentDefinition.getAttributeSecurity()!=null)
+            fieldDefinition.setAttributeSecurity(currentDefinition.getAttributeSecurity());
         
         fieldDefinition.setOverrideLookupClass(currentDefinition.getOverrideLookupClass());
         fieldDefinition.setOverrideFieldConversions(currentDefinition.getOverrideFieldConversions());
Index: C:/java/projects/kfs/work/src/org/kuali/kfs/sys/document/web/AccountingLineViewField.java
===================================================================
--- C:/java/projects/kfs/work/src/org/kuali/kfs/sys/document/web/AccountingLineViewField.java	(revision 18171)
+++ C:/java/projects/kfs/work/src/org/kuali/kfs/sys/document/web/AccountingLineViewField.java	(working copy)
@@ -322,7 +322,8 @@
         } else {
             if (!StringUtils.isBlank(getField().getPropertyValue())) {
                 if (getField().isSecure()) {
-                    renderer.setFieldValue(getField().getDisplayMask().maskValue(getField().getPropertyValue()));
+                    if(getField().getAttributeSecurity().isMask())
+                    renderer.setFieldValue(getField().getAttributeSecurity().getDisplayMaskValue(getField().getPropertyValue()));
                 } else {
                     renderer.setFieldValue(getDynamicNameLabelDisplayedValue(accountingLine));
                 }
Index: C:/java/projects/kfs/work/web-root/WEB-INF/tags/fin/dv/dvWireTransfer.tag
===================================================================
--- C:/java/projects/kfs/work/web-root/WEB-INF/tags/fin/dv/dvWireTransfer.tag	(revision 18171)
+++ C:/java/projects/kfs/work/web-root/WEB-INF/tags/fin/dv/dvWireTransfer.tag	(working copy)
@@ -1,118 +1,118 @@
-<%--
- Copyright 2007 The Kuali Foundation.
- 
- Licensed under the Educational Community License, Version 1.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
- 
- http://www.opensource.org/licenses/ecl1.php
- 
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
---%>
-<%@ include file="/jsp/kfs/kfsTldHeader.jsp"%>
-
-<kul:tab tabTitle="Wire Transfer" defaultOpen="false" tabErrorKey="${KFSConstants.DV_WIRETRANSFER_TAB_ERRORS}">
-	<c:set var="wireTransAttributes" value="${DataDictionary.DisbursementVoucherWireTransfer.attributes}" />
-    <div class="tab-container" align=center > 
-    <h3>Wire Transfer</h3>
-	<table cellpadding=0 class="datatable" summary="Wire Transfer Section">
-            
-               <tr>
-                <td colspan=4 align=left valign=middle class="datacell"><bean:write name="KualiForm" property="wireChargeMessage" /></td>
-              </tr>
-            
-               <tr>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbursementVoucherAutomatedClearingHouseProfileNumber}"/></div></th>
-                <td class="datacell">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbursementVoucherAutomatedClearingHouseProfileNumber}" property="document.dvWireTransfer.disbursementVoucherAutomatedClearingHouseProfileNumber" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbursementVoucherWireTransferFeeWaiverIndicator}"/> </div></th>
-                <td class="datacell">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbursementVoucherWireTransferFeeWaiverIndicator}" property="document.dvWireTransfer.disbursementVoucherWireTransferFeeWaiverIndicator" readOnly="${!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-              </tr>
-             
-              <tr>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbursementVoucherBankName}"/></div></th>
-                <td class="datacell">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbursementVoucherBankName}" property="document.dvWireTransfer.disbursementVoucherBankName" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrAdditionalWireText}"/></div></th>
-                <td class="datacell">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrAdditionalWireText}" property="document.dvWireTransfer.disbVchrAdditionalWireText" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-              </tr>
-              
-              <tr>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrBankRoutingNumber}"/>
-                    <c:if test="${fullEntryMode||wireEntryMode||frnEntryMode}">
-                        <br> *required for US bank
-                    </c:if>
-                </div></th>
-                <td class="datacell">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrBankRoutingNumber}" property="document.dvWireTransfer.disbVchrBankRoutingNumber" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrAttentionLineText}"/></div></th>
-                <td class="datacell">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrAttentionLineText}" property="document.dvWireTransfer.disbVchrAttentionLineText" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-              </tr>
-              
-              <tr>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrBankCityName}"/></div></th>
-                <td class="datacell">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrBankCityName}" property="document.dvWireTransfer.disbVchrBankCityName" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrCurrencyTypeCode}"/></div></th>
-                <td class="datacell">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrCurrencyTypeCode}" property="document.dvWireTransfer.disbVchrCurrencyTypeCode" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-              </tr>
-              
-              <tr>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrBankStateCode}"/>
-                    <c:if test="${fullEntryMode||wireEntryMode||frnEntryMode}">
-                        <br> *required for US bank
-                    </c:if>
-                </div></th>
-                <td class="datacell">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrBankStateCode}" property="document.dvWireTransfer.disbVchrBankStateCode" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrCurrencyTypeName}"/></div></th>
-                <td class="datacell" colspan="3">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrCurrencyTypeName}" property="document.dvWireTransfer.disbVchrCurrencyTypeName" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-              </tr>
-              
-              <tr>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrBankCountryCode}"/></div></th>
-                <td class="datacell" colspan="3">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrBankCountryCode}" property="document.dvWireTransfer.disbVchrBankCountryCode" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-              </tr>
-              
-              <tr>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrPayeeAccountNumber}"/></div></th>
-                <td class="datacell" colspan="3">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrPayeeAccountNumber}" property="document.dvWireTransfer.disbVchrPayeeAccountNumber"
-                   readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}" encryptValue="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}" displayMask="Not Displayed"/>
-                </td>
-              </tr>
-              
-              <tr>
-                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbursementVoucherPayeeAccountName}"/></div></th>
-                <td class="datacell">
-                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbursementVoucherPayeeAccountName}" property="document.dvWireTransfer.disbursementVoucherPayeeAccountName" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
-                </td>
-                <td class="datacell" colspan="2">
-                  <bean:message key="message.wiretransfer.fee"/>
-                </td>
-              </tr>
-            </tbody>
-          </table>
-        </div>
-</kul:tab>
+<%--
+ Copyright 2007 The Kuali Foundation.
+ 
+ Licensed under the Educational Community License, Version 1.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+ 
+ http://www.opensource.org/licenses/ecl1.php
+ 
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+--%>
+<%@ include file="/jsp/kfs/kfsTldHeader.jsp"%>
+
+<kul:tab tabTitle="Wire Transfer" defaultOpen="false" tabErrorKey="${KFSConstants.DV_WIRETRANSFER_TAB_ERRORS}">
+	<c:set var="wireTransAttributes" value="${DataDictionary.DisbursementVoucherWireTransfer.attributes}" />
+    <div class="tab-container" align=center > 
+    <h3>Wire Transfer</h3>
+	<table cellpadding=0 class="datatable" summary="Wire Transfer Section">
+            
+               <tr>
+                <td colspan=4 align=left valign=middle class="datacell"><bean:write name="KualiForm" property="wireChargeMessage" /></td>
+              </tr>
+            
+               <tr>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbursementVoucherAutomatedClearingHouseProfileNumber}"/></div></th>
+                <td class="datacell">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbursementVoucherAutomatedClearingHouseProfileNumber}" property="document.dvWireTransfer.disbursementVoucherAutomatedClearingHouseProfileNumber" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbursementVoucherWireTransferFeeWaiverIndicator}"/> </div></th>
+                <td class="datacell">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbursementVoucherWireTransferFeeWaiverIndicator}" property="document.dvWireTransfer.disbursementVoucherWireTransferFeeWaiverIndicator" readOnly="${!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+              </tr>
+             
+              <tr>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbursementVoucherBankName}"/></div></th>
+                <td class="datacell">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbursementVoucherBankName}" property="document.dvWireTransfer.disbursementVoucherBankName" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrAdditionalWireText}"/></div></th>
+                <td class="datacell">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrAdditionalWireText}" property="document.dvWireTransfer.disbVchrAdditionalWireText" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+              </tr>
+              
+              <tr>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrBankRoutingNumber}"/>
+                    <c:if test="${fullEntryMode||wireEntryMode||frnEntryMode}">
+                        <br> *required for US bank
+                    </c:if>
+                </div></th>
+                <td class="datacell">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrBankRoutingNumber}" property="document.dvWireTransfer.disbVchrBankRoutingNumber" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrAttentionLineText}"/></div></th>
+                <td class="datacell">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrAttentionLineText}" property="document.dvWireTransfer.disbVchrAttentionLineText" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+              </tr>
+              
+              <tr>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrBankCityName}"/></div></th>
+                <td class="datacell">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrBankCityName}" property="document.dvWireTransfer.disbVchrBankCityName" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrCurrencyTypeCode}"/></div></th>
+                <td class="datacell">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrCurrencyTypeCode}" property="document.dvWireTransfer.disbVchrCurrencyTypeCode" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+              </tr>
+              
+              <tr>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrBankStateCode}"/>
+                    <c:if test="${fullEntryMode||wireEntryMode||frnEntryMode}">
+                        <br> *required for US bank
+                    </c:if>
+                </div></th>
+                <td class="datacell">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrBankStateCode}" property="document.dvWireTransfer.disbVchrBankStateCode" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrCurrencyTypeName}"/></div></th>
+                <td class="datacell" colspan="3">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrCurrencyTypeName}" property="document.dvWireTransfer.disbVchrCurrencyTypeName" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+              </tr>
+              
+              <tr>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrBankCountryCode}"/></div></th>
+                <td class="datacell" colspan="3">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrBankCountryCode}" property="document.dvWireTransfer.disbVchrBankCountryCode" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+              </tr>
+              
+              <tr>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbVchrPayeeAccountNumber}"/></div></th>
+                <td class="datacell" colspan="3">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbVchrPayeeAccountNumber}" property="document.dvWireTransfer.disbVchrPayeeAccountNumber"
+                   readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}" encryptValue="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}" displayMaskValue="Not Displayed"/>
+                </td>
+              </tr>
+              
+              <tr>
+                <th scope=row class="bord-l-b"><div align="right"><kul:htmlAttributeLabel attributeEntry="${wireTransAttributes.disbursementVoucherPayeeAccountName}"/></div></th>
+                <td class="datacell">
+                  <kul:htmlControlAttribute attributeEntry="${wireTransAttributes.disbursementVoucherPayeeAccountName}" property="document.dvWireTransfer.disbursementVoucherPayeeAccountName" readOnly="${!fullEntryMode&&!wireEntryMode&&!frnEntryMode}"/>
+                </td>
+                <td class="datacell" colspan="2">
+                  <bean:message key="message.wiretransfer.fee"/>
+                </td>
+              </tr>
+            </tbody>
+          </table>
+        </div>
+</kul:tab>
Index: C:/java/projects/kfs/work/web-root/WEB-INF/tags/fin/procurementCardAccountingLines.tag
===================================================================
--- C:/java/projects/kfs/work/web-root/WEB-INF/tags/fin/procurementCardAccountingLines.tag	(revision 18171)
+++ C:/java/projects/kfs/work/web-root/WEB-INF/tags/fin/procurementCardAccountingLines.tag	(working copy)
@@ -1,156 +1,156 @@
-<%--
- Copyright 2006-2007 The Kuali Foundation.
- 
- Licensed under the Educational Community License, Version 1.0 (the "License");
- you may not use this file except in compliance with the License.
- You may obtain a copy of the License at
- 
- http://www.opensource.org/licenses/ecl1.php
- 
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
---%>
-<%@ include file="/jsp/kfs/kfsTldHeader.jsp"%>
-
-<%@ attribute name="editingMode" required="false" type="java.util.Map"%>
-<%@ attribute name="editableAccounts" required="true" type="java.util.Map"
-              description="Map of Accounts which this user is allowed to edit" %>
-<%@ attribute name="editableFields" required="false" type="java.util.Map"
-              description="Map of accounting line fields which this user is allowed to edit" %>
-
-<c:forEach items="${editableAccounts}" var="account">
-  <html:hidden property="editableAccounts(${account.key})" value="${account.key}"/>
-</c:forEach>
-
-<c:forEach items="${editableFields}" var="field">
-  <html:hidden property="accountingLineEditableFields(${field.key})"/>
-</c:forEach>
-
-<c:set var="columnCountUntilAmount" value="8" />
-<c:set var="columnCount" value="${columnCountUntilAmount + 1 + (empty editingMode['viewOnly'] ? 1 : 0)}" />
-<c:set var="accountingLineAttributes" value="${DataDictionary['TargetAccountingLine'].attributes}" />
+<%--
+ Copyright 2006-2007 The Kuali Foundation.
+ 
+ Licensed under the Educational Community License, Version 1.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
+ 
+ http://www.opensource.org/licenses/ecl1.php
+ 
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+--%>
+<%@ include file="/jsp/kfs/kfsTldHeader.jsp"%>
 
-<kfs:accountingLineScriptImports />
-<kul:tab tabTitle="Accounting Lines" defaultOpen="true" tabErrorKey="${KFSConstants.TARGET_ACCOUNTING_LINE_ERROR_PATTERN},document.transactionEntries*">
-  <c:set var="transactionAttributes" value="${DataDictionary.ProcurementCardTransactionDetail.attributes}" />
-  <c:set var="vendorAttributes" value="${DataDictionary.ProcurementCardVendor.attributes}" />
-  <c:set var="cardAttributes" value="${DataDictionary.ProcurementCardHolder.attributes}" />
-	
-  <div class="tab-container" align=center>
-  <c:set var="totalNewTargetCtr" value="0"/>
-  <c:set var="baseCtr" value="0"/>
-  <logic:iterate indexId="ctr" name="KualiForm" property="document.transactionEntries" id="currentTransaction">
-    <table cellpadding="0" class="datatable" summary="Transaction Details">
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].documentNumber"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].financialDocumentTransactionLineNumber"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionPostingDate"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionOriginalCurrencyCode"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionBillingCurrencyCode"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionOriginalCurrencyAmount"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionCurrencyExchangeRate"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionSettlementAmount"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionSalesTaxAmount"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionTaxExemptIndicator"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionPurchaseIdentifierIndicator"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionPurchaseIdentifierDescription"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionUnitContactName"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionTravelAuthorizationCode"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionPointOfSaleCode"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionCycleStartDate"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionCycleEndDate"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].versionNumber"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.documentNumber"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.financialDocumentTransactionLineNumber"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorName"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorLine1Address"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorLine2Address"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorCityName"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorStateCode"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorZipCode"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.visaVendorIdentifier"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorOrderNumber"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.transactionMerchantCategoryCode"/>
-       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.versionNumber"/>
-       
-       <%-- write out source (actually from lines) as hiddens since they are not displayed but need repopulated --%>
-       <logic:iterate indexId="tCtr" name="KualiForm" property="document.transactionEntries[${ctr}].sourceAccountingLines" id="currentLine">
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].documentNumber"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].financialDocumentTransactionLineNumber"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].sequenceNumber"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].versionNumber"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].chartOfAccountsCode"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].accountNumber"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].postingYear"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].financialObjectCode"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].balanceTypeCode"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].amount"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].subAccountNumber"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].financialSubObjectCode"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].projectCode"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].organizationReferenceId"/>
-        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].overrideCode"/>
-      </logic:iterate>
-                                                                                           
-       <fin:subheadingWithDetailToggleRow columnCount="4" subheading="Transaction #${currentTransaction.transactionReferenceNumber}"/>
-	      <tr>
-	        <th scope="row"><div align="right"><kul:htmlAttributeLabel attributeEntry="${cardAttributes.transactionCreditCardNumber}" readOnly="true"/></div></th>
-	        <td>
-	          <kul:inquiry boClassName="org.kuali.kfs.fp.businessobject.ProcurementCardHolder" 
-               keyValues="documentNumber=${currentTransaction.documentNumber}" 
-               render="true">
-	            <kul:htmlControlAttribute attributeEntry="${cardAttributes.transactionCreditCardNumber}" property="document.procurementCardHolder.transactionCreditCardNumber"
-	             readOnly="true" encryptValue="${!empty KualiForm.editingMode['viewOnly']}" displayMask="****************" />
-	          </kul:inquiry>
-	        </td>
-	      </tr>
-	      <tr>
-	        <th scope="row"><div align="right"><kul:htmlAttributeLabel attributeEntry="${cardAttributes.cardHolderName}" readOnly="true"/></div></th>
-	        <td><kul:htmlControlAttribute attributeEntry="${cardAttributes.cardHolderName}" property="document.procurementCardHolder.cardHolderName" readOnly="true"/></td>
-            <th> <div align="right"><kul:htmlAttributeLabel attributeEntry="${transactionAttributes.transactionTotalAmount}"/></div></th>
-            <td valign=top><kul:htmlControlAttribute attributeEntry="${transactionAttributes.transactionTotalAmount}" property="document.transactionEntries[${ctr}].transactionTotalAmount" readOnly="true"/></td>
-	     </tr>
-       <tr>
-          <th><div align="right"><kul:htmlAttributeLabel attributeEntry="${transactionAttributes.transactionDate}"/></div></th>
-          <td valign=top><html:hidden write="true" property="document.transactionEntries[${ctr}].transactionDate"/></td>
-          <th> <div align="right"><kul:htmlAttributeLabel attributeEntry="${transactionAttributes.transactionReferenceNumber}"/></div></th>
-          <td valign=top>
-            <kul:inquiry boClassName="org.kuali.kfs.fp.businessobject.ProcurementCardTransactionDetail" 
-               keyValues="documentNumber=${currentTransaction.documentNumber}&financialDocumentTransactionLineNumber=${currentTransaction.financialDocumentTransactionLineNumber}" 
-               render="true">
-              <html:hidden write="true" property="document.transactionEntries[${ctr}].transactionReferenceNumber"/>
-            </kul:inquiry>
-          </td>
-       </tr>   
-       <tr>  
-          <th> <div align="right"><kul:htmlAttributeLabel attributeEntry="${vendorAttributes.vendorName}"/></div></th> 
-          <td valign=top>
-            <kul:inquiry boClassName="org.kuali.kfs.fp.businessobject.ProcurementCardVendor" 
-               keyValues="documentNumber=${currentTransaction.documentNumber}&financialDocumentTransactionLineNumber=${currentTransaction.financialDocumentTransactionLineNumber}" 
-               render="true">
-              <html:hidden write="true" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorName"/>
-            </kul:inquiry>  
-          </td>
-          <th colspan="2"> <div align="left">
-          <c:if test="${empty editingMode['viewOnly']}">
-            <a href="${KualiForm.disputeURL}" target="_blank"><img src="${ConfigProperties.externalizable.images.url}buttonsmall_dispute.gif"/></a>
-          </c:if>
-          </div></th>
-       </tr>   
-    </table>   
+<%@ attribute name="editingMode" required="false" type="java.util.Map"%>
+<%@ attribute name="editableAccounts" required="true" type="java.util.Map"
+              description="Map of Accounts which this user is allowed to edit" %>
+<%@ attribute name="editableFields" required="false" type="java.util.Map"
+              description="Map of accounting line fields which this user is allowed to edit" %>
+
+<c:forEach items="${editableAccounts}" var="account">
+  <html:hidden property="editableAccounts(${account.key})" value="${account.key}"/>
+</c:forEach>
+
+<c:forEach items="${editableFields}" var="field">
+  <html:hidden property="accountingLineEditableFields(${field.key})"/>
+</c:forEach>
+
+<c:set var="columnCountUntilAmount" value="8" />
+<c:set var="columnCount" value="${columnCountUntilAmount + 1 + (empty editingMode['viewOnly'] ? 1 : 0)}" />
+<c:set var="accountingLineAttributes" value="${DataDictionary['TargetAccountingLine'].attributes}" />
+
+<kfs:accountingLineScriptImports />
+<kul:tab tabTitle="Accounting Lines" defaultOpen="true" tabErrorKey="${KFSConstants.TARGET_ACCOUNTING_LINE_ERROR_PATTERN},document.transactionEntries*">
+  <c:set var="transactionAttributes" value="${DataDictionary.ProcurementCardTransactionDetail.attributes}" />
+  <c:set var="vendorAttributes" value="${DataDictionary.ProcurementCardVendor.attributes}" />
+  <c:set var="cardAttributes" value="${DataDictionary.ProcurementCardHolder.attributes}" />
 	
+  <div class="tab-container" align=center>
+  <c:set var="totalNewTargetCtr" value="0"/>
+  <c:set var="baseCtr" value="0"/>
+  <logic:iterate indexId="ctr" name="KualiForm" property="document.transactionEntries" id="currentTransaction">
+    <table cellpadding="0" class="datatable" summary="Transaction Details">
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].documentNumber"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].financialDocumentTransactionLineNumber"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionPostingDate"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionOriginalCurrencyCode"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionBillingCurrencyCode"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionOriginalCurrencyAmount"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionCurrencyExchangeRate"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionSettlementAmount"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionSalesTaxAmount"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionTaxExemptIndicator"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionPurchaseIdentifierIndicator"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionPurchaseIdentifierDescription"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionUnitContactName"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionTravelAuthorizationCode"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionPointOfSaleCode"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionCycleStartDate"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].transactionCycleEndDate"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].versionNumber"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.documentNumber"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.financialDocumentTransactionLineNumber"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorName"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorLine1Address"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorLine2Address"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorCityName"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorStateCode"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorZipCode"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.visaVendorIdentifier"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorOrderNumber"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.transactionMerchantCategoryCode"/>
+       <html:hidden write="false" property="document.transactionEntries[${ctr}].procurementCardVendor.versionNumber"/>
+       
+       <%-- write out source (actually from lines) as hiddens since they are not displayed but need repopulated --%>
+       <logic:iterate indexId="tCtr" name="KualiForm" property="document.transactionEntries[${ctr}].sourceAccountingLines" id="currentLine">
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].documentNumber"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].financialDocumentTransactionLineNumber"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].sequenceNumber"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].versionNumber"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].chartOfAccountsCode"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].accountNumber"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].postingYear"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].financialObjectCode"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].balanceTypeCode"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].amount"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].subAccountNumber"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].financialSubObjectCode"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].projectCode"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].organizationReferenceId"/>
+        <html:hidden write="false" property="document.transactionEntries[${ctr}].sourceAccountingLines[${tCtr}].overrideCode"/>
+      </logic:iterate>
+                                                                                           
+       <fin:subheadingWithDetailToggleRow columnCount="4" subheading="Transaction #${currentTransaction.transactionReferenceNumber}"/>
+	      <tr>
+	        <th scope="row"><div align="right"><kul:htmlAttributeLabel attributeEntry="${cardAttributes.transactionCreditCardNumber}" readOnly="true"/></div></th>
+	        <td>
+	          <kul:inquiry boClassName="org.kuali.kfs.fp.businessobject.ProcurementCardHolder" 
+               keyValues="documentNumber=${currentTransaction.documentNumber}" 
+               render="true">
+	            <kul:htmlControlAttribute attributeEntry="${cardAttributes.transactionCreditCardNumber}" property="document.procurementCardHolder.transactionCreditCardNumber"
+	             readOnly="true" encryptValue="${!empty KualiForm.editingMode['viewOnly']}" displayMaskValue="****************" />
+	          </kul:inquiry>
+	        </td>
+	      </tr>
+	      <tr>
+	        <th scope="row"><div align="right"><kul:htmlAttributeLabel attributeEntry="${cardAttributes.cardHolderName}" readOnly="true"/></div></th>
+	        <td><kul:htmlControlAttribute attributeEntry="${cardAttributes.cardHolderName}" property="document.procurementCardHolder.cardHolderName" readOnly="true"/></td>
+            <th> <div align="right"><kul:htmlAttributeLabel attributeEntry="${transactionAttributes.transactionTotalAmount}"/></div></th>
+            <td valign=top><kul:htmlControlAttribute attributeEntry="${transactionAttributes.transactionTotalAmount}" property="document.transactionEntries[${ctr}].transactionTotalAmount" readOnly="true"/></td>
+	     </tr>
+       <tr>
+          <th><div align="right"><kul:htmlAttributeLabel attributeEntry="${transactionAttributes.transactionDate}"/></div></th>
+          <td valign=top><html:hidden write="true" property="document.transactionEntries[${ctr}].transactionDate"/></td>
+          <th> <div align="right"><kul:htmlAttributeLabel attributeEntry="${transactionAttributes.transactionReferenceNumber}"/></div></th>
+          <td valign=top>
+            <kul:inquiry boClassName="org.kuali.kfs.fp.businessobject.ProcurementCardTransactionDetail" 
+               keyValues="documentNumber=${currentTransaction.documentNumber}&financialDocumentTransactionLineNumber=${currentTransaction.financialDocumentTransactionLineNumber}" 
+               render="true">
+              <html:hidden write="true" property="document.transactionEntries[${ctr}].transactionReferenceNumber"/>
+            </kul:inquiry>
+          </td>
+       </tr>   
+       <tr>  
+          <th> <div align="right"><kul:htmlAttributeLabel attributeEntry="${vendorAttributes.vendorName}"/></div></th> 
+          <td valign=top>
+            <kul:inquiry boClassName="org.kuali.kfs.fp.businessobject.ProcurementCardVendor" 
+               keyValues="documentNumber=${currentTransaction.documentNumber}&financialDocumentTransactionLineNumber=${currentTransaction.financialDocumentTransactionLineNumber}" 
+               render="true">
+              <html:hidden write="true" property="document.transactionEntries[${ctr}].procurementCardVendor.vendorName"/>
+            </kul:inquiry>  
+          </td>
+          <th colspan="2"> <div align="left">
+          <c:if test="${empty editingMode['viewOnly']}">
+            <a href="${KualiForm.disputeURL}" target="_blank"><img src="${ConfigProperties.externalizable.images.url}buttonsmall_dispute.gif"/></a>
+          </c:if>
+          </div></th>
+       </tr>   
+    </table>   
+	
     <table width="100%" border="0" cellpadding="0" cellspacing="0" class="datatable">
-		<sys:accountingLineGroup newLinePropertyName="newTargetLines[${totalNewTargetCtr}]" collectionPropertyName="document.transactionEntries[${ctr}].targetAccountingLines" collectionItemPropertyName="document.transactionEntries[${ctr}].targetAccountingLine" attributeGroupName="target" />
-	</table>
-    
-    <br/>
-    <c:set var="totalNewTargetCtr" value="${totalNewTargetCtr+1}"/>
-   </logic:iterate> 
-  </div>
-  <SCRIPT type="text/javascript">
-    var kualiForm = document.forms['KualiForm'];
-    var kualiElements = kualiForm.elements;
-  </SCRIPT>
-</kul:tab>
+		<sys:accountingLineGroup newLinePropertyName="newTargetLines[${totalNewTargetCtr}]" collectionPropertyName="document.transactionEntries[${ctr}].targetAccountingLines" collectionItemPropertyName="document.transactionEntries[${ctr}].targetAccountingLine" attributeGroupName="target" />
+	</table>
+    
+    <br/>
+    <c:set var="totalNewTargetCtr" value="${totalNewTargetCtr+1}"/>
+   </logic:iterate> 
+  </div>
+  <SCRIPT type="text/javascript">
+    var kualiForm = document.forms['KualiForm'];
+    var kualiElements = kualiForm.elements;
+  </SCRIPT>
+</kul:tab>
