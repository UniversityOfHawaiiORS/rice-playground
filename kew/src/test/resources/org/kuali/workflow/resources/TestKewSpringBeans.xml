<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

  <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="properties" ref="configProperties"/>
  </bean>

  <bean id="config" class="org.kuali.rice.config.spring.ConfigFactoryBean">
    <property name="configLocations">
      <list>
        <value>classpath:META-INF/server-test-config.xml</value>
      </list>
    </property>
  </bean>

  <bean id="configProperties" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="targetObject" ref="config"/>
    <property name="targetMethod" value="getProperties"/>
  </bean>

  <bean id="atomikosTransactionManager" class="com.atomikos.icatch.jta.UserTransactionManager" init-method="init" destroy-method="close">
	<property name="forceShutdown" value="true"/>
	<property name="transactionTimeout" value="${transaction.timeout}"/>
  </bean>
  
  <bean id="atomikosUserTransaction" class="com.atomikos.icatch.jta.UserTransactionImp">
    <property name="transactionTimeout" value="${transaction.timeout}"/>
  </bean>

  <bean id="workflowDataSource" class="com.atomikos.jdbc.nonxa.NonXADataSourceBean">
  	<property name="uniqueResourceName" value="kewDataSource"/>
  	<property name="driverClassName" value="${datasource.driver.name}"/>
  	<property name="url" value="${datasource.url}"/>
  	<property name="poolSize" value="${datasource.pool.maxSize}"/>
  	<property name="connectionTimeout" value="${datasource.pool.maxWait}"/>
  	<property name="validatingQuery" value="${datasource.pool.validationQuery}"/>
  	<property name="testOnBorrow" value="true"/>
  	<property name="user" value="${datasource.username}"/>
  	<property name="password" value="${datasource.password}"/>
  </bean>

	<bean id="rice" class="org.kuali.rice.config.RiceConfigurer">
		<property name="dataSource" ref="workflowDataSource" />
		<property name="transactionManager" ref="atomikosTransactionManager" />
		<property name="userTransaction" ref="atomikosUserTransaction" />
		<property name="rootConfig" ref="config" />
		<property name="properties">
			<props>
				<prop key="plugin.registry.enabled">true</prop>
				<prop key="kew.standalone.server">true</prop>
			</props>
		</property>
		<property name="modules">
			<list>
				<bean class="edu.iu.uis.eden.messaging.config.KSBConfigurer">
					<property name="serviceServletUrl" value="${serviceServletUrl}" />
				</bean>
				<bean class="org.kuali.workflow.config.KEWConfigurer">
					<property name="clientProtocol" value="local" />
				</bean>
			</list>
		</property>
	</bean>

</beans>