<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
	<bean id="userTransaction" class="org.kuali.rice.jta.UserTransactionFactoryBean" lazy-init="true" />

	<bean id="jtaTransactionManager" class="org.kuali.rice.jta.TransactionManagerFactoryBean" lazy-init="true" />

	<bean id="ojbConfigurer" class="org.kuali.rice.ojb.JtaOjbConfigurer">
		<property name="transactionManager" ref="jtaTransactionManager" />
	</bean>

	<bean id="transactionManager" class="org.springframework.transaction.jta.JtaTransactionManager" lazy-init="true">
		<property name="userTransaction">
			<ref local="userTransaction" />
		</property>
		<property name="transactionManager">
			<ref local="jtaTransactionManager" />
		</property>
	</bean>

	<bean id="kimDataSource" class="org.kuali.rice.database.PrimaryDataSourceFactoryBean" lazy-init="true"/>

	<bean id="transactionTemplate" class="org.springframework.transaction.support.TransactionTemplate" lazy-init="true">
		<property name="transactionManager">
			<ref bean="transactionManager" />
		</property>
	</bean>

	<!-- Proxy for rollback on all exceptions -->
	<bean id="matchAllWithPropReqCheckedException" class="org.springframework.transaction.interceptor.MatchAlwaysTransactionAttributeSource"
		lazy-init="true">
		<property name="transactionAttribute">
			<value>PROPAGATION_REQUIRED,-Exception</value>
		</property>
	</bean>

	<bean id="matchAllWithPropReq" class="org.springframework.transaction.interceptor.MatchAlwaysTransactionAttributeSource" lazy-init="true">
		<property name="transactionAttribute">
			<value>PROPAGATION_REQUIRED</value>
		</property>
	</bean>

	<bean id="matchAllTxInterceptor" class="org.springframework.transaction.interceptor.TransactionInterceptor" lazy-init="true">
		<property name="transactionManager">
			<ref bean="transactionManager" />
		</property>
		<property name="transactionAttributeSource">
			<ref bean="matchAllWithPropReq" />
		</property>
	</bean>

	<bean class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator" lazy-init="true">
		<property name="interceptorNames">
			<list>
				<idref local="matchAllTxInterceptor" />
			</list>
		</property>
		<property name="beanNames">
			<list>
				<idref local="personService" />
				<idref local="groupService" />
				<idref local="namespaceService" />
				<idref local="qualifiedRoleService" />
				<idref local="roleService" />
			</list>
		</property>
	</bean>

	<bean id="personService" class="org.kuali.rice.kim.service.impl.PersonServiceImpl" />
	<bean id="groupService" class="org.kuali.rice.kim.service.impl.GroupServiceImpl" />
	<bean id="namespaceService" class="org.kuali.rice.kim.service.impl.NamespaceServiceImpl" />
	<bean id="qualifiedRoleService" class="org.kuali.rice.kim.service.impl.QualifiedRoleServiceImpl" />
	<bean id="roleService" class="org.kuali.rice.kim.service.impl.RoleServiceImpl" />
 
    <bean id="kimModule" class="org.kuali.core.KualiModule">
		<property name="moduleId" value="kim"/>
		<property name="moduleName" value="KIM"/>
		<property name="moduleCode" value="kim"/>
		<property name="initializeDataDictionary" value="true"/>
		<property name="dataDictionaryPackages">
			<list>
			    <value>classpath:org/kuali/rice/kim/bo/datadictionary/AbstractQualifiedRoleAttribute.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/AttributeType.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/Group.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/GroupAttribute.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/Namespace.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/NamespaceDefaultAttribute.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/Principal.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/Role.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/RoleAttribute.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/EntityType.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/Entity.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/EntityAttribute.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/Permission.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/GroupType.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/GroupTypeDefaultAttribute.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/GroupQualifiedRole.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/RoleQualificationForGroup.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/GroupQualifiedRoleAttribute.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/PrincipalQualifiedRole.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/RoleQualificationForPrincipal.xml</value>
				<value>classpath:org/kuali/rice/kim/bo/datadictionary/PrincipalQualifiedRoleAttribute.xml</value>
				<value>classpath:org/kuali/rice/kim/document/datadictionary/AttributeTypeMaintenanceDocument.xml</value>
				<value>classpath:org/kuali/rice/kim/document/datadictionary/GroupMaintenanceDocument.xml</value>
				<value>classpath:org/kuali/rice/kim/document/datadictionary/NamespaceMaintenanceDocument.xml</value>
				<value>classpath:org/kuali/rice/kim/document/datadictionary/PrincipalMaintenanceDocument.xml</value>
				<value>classpath:org/kuali/rice/kim/document/datadictionary/RoleMaintenanceDocument.xml</value>
				<value>classpath:org/kuali/rice/kim/document/datadictionary/EntityTypeMaintenanceDocument.xml</value>
				<value>classpath:org/kuali/rice/kim/document/datadictionary/EntityMaintenanceDocument.xml</value>
				<value>classpath:org/kuali/rice/kim/document/datadictionary/GroupTypeMaintenanceDocument.xml</value>
                <!--  
                <value>classpath:org/kuali/rice/kom/bo/datadictionary/Organization.xml</value>
                <value>classpath:org/kuali/rice/kom/bo/datadictionary/OrganizationCategory.xml</value>
                <value>classpath:org/kuali/rice/kom/bo/datadictionary/OrganizationContext.xml</value>
                <value>classpath:org/kuali/rice/kom/document/datadictionary/OrganizationMaintenanceDocument.xml</value>
                <value>classpath:org/kuali/rice/kom/document/datadictionary/OrganizationContextMaintenanceDocument.xml</value>
                <value>classpath:org/kuali/rice/kom/document/datadictionary/OrganizationCategoryMaintenanceDocument.xml</value>
                -->
            </list>
		</property>
	</bean>

    <bean class="edu.iu.uis.eden.messaging.KSBExporter">
      <property name="serviceDefinition">
        <bean class="edu.iu.uis.eden.messaging.SOAPServiceDefinition">
          <property name="service" ref="groupService" />
          <property name="serviceNameSpaceURI" value="KIM"/>
          <property name="localServiceName" value="groupSoapService" />
          <property name="priority" value="3" />
          <property name="retryAttempts" value="0" />
          <property name="busSecurity" value="false"/>
        </bean>
      </property>
    </bean>

    <bean class="edu.iu.uis.eden.messaging.KSBExporter">
      <property name="serviceDefinition">
        <bean class="edu.iu.uis.eden.messaging.JavaServiceDefinition">
          <property name="service" ref="groupService" />
          <property name="serviceNameSpaceURI" value="KIM"/>
          <property name="localServiceName" value="groupService" />
          <property name="retryAttempts" value="0" />
        </bean>
      </property>
    </bean>

    <bean class="edu.iu.uis.eden.messaging.KSBExporter">
      <property name="serviceDefinition">
        <bean class="edu.iu.uis.eden.messaging.SOAPServiceDefinition">
          <property name="service" ref="namespaceService" />
          <property name="serviceNameSpaceURI" value="KIM"/>
          <property name="localServiceName" value="namespaceSoapService" />
          <property name="priority" value="3" />
          <property name="retryAttempts" value="0" />
          <property name="busSecurity" value="false"/>
        </bean>
      </property>
    </bean>

    <bean class="edu.iu.uis.eden.messaging.KSBExporter">
      <property name="serviceDefinition">
        <bean class="edu.iu.uis.eden.messaging.JavaServiceDefinition">
          <property name="service" ref="namespaceService" />
          <property name="serviceNameSpaceURI" value="KIM"/>
          <property name="localServiceName" value="namespaceService" />
          <property name="retryAttempts" value="0" />
        </bean>
      </property>
    </bean>
</beans>
